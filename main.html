<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>דברי תורה שבועיים - מבואה</title>
    <style>
        :root {
            --primary-color: #3f51b5;
            --accent-color: #ff9800;
            --bg-color: #f8f9fa;
            --text-color: #333;
            --header-bg: #f0f4f8;
            --footer-bg: #e1e5eb;
            --border-color: #ddd;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        header {
            background-color: var(--header-bg);
            padding: 1rem 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .site-title {
            font-size: 2.2rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            text-align: center;
        }
        
        .site-subtitle {
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 1rem;
            color: #555;
        }
        
        .parasha-banner {
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            padding: 10px 0;
            font-size: 1.3rem;
            margin-top: 1rem;
        }
        
        .parasha-selector {
            text-align: center;
            margin: 10px 0;
        }
        
        .parasha-selector select {
            padding: 8px 15px;
            font-size: 1rem;
            border-radius: 5px;
            border: 1px solid var(--border-color);
            background-color: white;
            margin-right: 10px;
        }
        
        .parasha-selector button {
            padding: 8px 15px;
            font-size: 1rem;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .parasha-selector button:hover {
            background-color: #e68a00;
        }
        
        nav {
            display: flex;
            justify-content: center;
            margin-top: 1rem;
            border-top: 1px solid var(--border-color);
            padding-top: 1rem;
        }
        
        .nav-links {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            list-style: none;
            gap: 20px;
        }
        
        .nav-links li a {
            display: block;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .nav-links li a:hover,
        .nav-links li a.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        main {
            padding: 2rem 0;
        }
        
        .page-title {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--primary-color);
            font-size: 2rem;
        }
        
        .content-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .content-header {
            border-bottom: 2px solid var(--primary-color);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
        }
        
        .content-title {
            font-size: 1.6rem;
            color: var(--primary-color);
        }
        
        .content-meta {
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.5rem;
        }
        
        .content-body {
            line-height: 1.8;
            font-size: 1.1rem;
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
            font-size: 1.2rem;
            color: #777;
        }
        
        footer {
            background-color: var(--footer-bg);
            padding: 1.5rem 0;
            text-align: center;
            margin-top: 2rem;
            border-top: 1px solid var(--border-color);
        }
        
        .copyright {
            font-size: 0.9rem;
            color: #555;
        }
        
        .archive-section {
            margin-top: 3rem;
        }
        
        .archive-title {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .archive-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 1.5rem;
        }
        
        .archive-item {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            transition: transform 0.3s ease;
        }
        
        .archive-item:hover {
            transform: translateY(-5px);
        }
        
        .archive-item h4 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .archive-item p {
            font-size: 0.9rem;
            color: #666;
        }
        
        .archive-item a {
            display: inline-block;
            margin-top: 0.5rem;
            color: var(--accent-color);
            text-decoration: none;
        }
        
        .archive-item a:hover {
            text-decoration: underline;
        }
        
        @media (max-width: 768px) {
            .nav-links {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
            
            .content-container {
                padding: 1rem;
            }
            
            .archive-items {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1 class="site-title">דברי תורה שבועיים</h1>
            <p class="site-subtitle">מאת רבני בית הספר</p>
            
            <div class="parasha-banner" id="current-parasha-banner">
                פרשת השבוע: <span id="current-parasha-name">טוען...</span>
            </div>
            
            <div class="parasha-selector">
                <select id="parasha-select">
                    <option value="">בחר פרשה אחרת...</option>
                    <!-- רשימת הפרשות תיטען באמצעות JavaScript -->
                </select>
                <button id="load-parasha-btn">טען</button>
            </div>
            
            <nav>
                <ul class="nav-links">
                    <li><a href="index.html" class="active">מבואה</a></li>
                    <li><a href="aktualya.html">אקטואליה</a></li>
                    <li><a href="values.html">ערכים</a></li>
                    <li><a href="language.html">שפה</a></li>
                    <li><a href="wisdom.html">פניני חוכמה</a></li>
                    <li><a href="empowerment.html">העצמה וכלים לחיים</a></li>
                    <li><a href="parasha.html">אתגר הפרשה</a></li>
                    <li><a href="creativity.html">יצירה</a></li>
                    <li><a href="mission.html">שליחות</a></li>
                </ul>
            </nav>
        </div>
    </header>
    
    <main class="container">
        <h2 class="page-title">דבר תורה לפרשת השבוע</h2>
        
        <div id="content-area">
            <div class="loading">טוען את דבר התורה...</div>
        </div>
        
        <div class="archive-section">
            <h3 class="archive-title">דברי תורה מפרשות קודמות</h3>
            <div id="archive-items" class="archive-items">
                <!-- כאן יוצגו דברי תורה מפרשות קודמות -->
            </div>
        </div>
    </main>
    
    <footer>
        <div class="container">
            <p class="copyright">© כל הזכויות שמורות לבית הספר - 2025</p>
        </div>
    </footer>
    
    <script>
        // ========== הגדרות שיש לעדכן ==========
        // קישור לגיליון הנתונים (שנה קישור זה כשצריך)
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSuqfhHb4HdLcP3WLMT33O61cP_5bQrryiZ-qVSPiAfQNaWCi32iNePVcOdFM7faykcbUX-FpoTuYdE/pub?output=csv';
        // ========================================
        
        // רשימת פרשות השבוע
        const parashot = [
            "בראשית", "נח", "לך לך", "וירא", "חיי שרה", "תולדות", "ויצא", "וישלח", "וישב", "מקץ",
            "ויגש", "ויחי", "שמות", "וארא", "בא", "בשלח", "יתרו", "משפטים", "תרומה", "תצוה",
            "כי תשא", "ויקהל", "פקודי", "ויקרא", "צו", "שמיני", "תזריע", "מצורע", "אחרי מות", "קדושים",
            "אמור", "בהר", "בחוקותי", "במדבר", "נשא", "בהעלותך", "שלח", "קרח", "חקת", "בלק",
            "פינחס", "מטות", "מסעי", "דברים", "ואתחנן", "עקב", "ראה", "שופטים", "כי תצא", "כי תבוא",
            "ניצבים", "וילך", "האזינו", "וזאת הברכה"
        ];
        
        // פונקציה לטעינת בחירת הפרשות
        function loadParashotOptions() {
            const selectElement = document.getElementById('parasha-select');
            
            // מילוי אפשרויות הבחירה
            parashot.forEach(parasha => {
                const option = document.createElement('option');
                option.value = parasha;
                option.textContent = parasha;
                selectElement.appendChild(option);
            });
            
            // אירוע לחיצה על כפתור הטעינה
            document.getElementById('load-parasha-btn').addEventListener('click', () => {
                const selectedParasha = selectElement.value;
                if (selectedParasha) {
                    loadParashaContent(selectedParasha);
                }
            });
        }
        
        // פונקציה לקביעת הפרשה הנוכחית לפי התאריך
        function getCurrentParasha() {
            // במקור, כאן אפשר להשתמש באלגוריתם מורכב יותר לחישוב הפרשה הנוכחית
            // לצורך הדוגמה, נשתמש בפרשה קבועה
            
            // בהמשך אפשר להוסיף לוח שנה עברי ולחשב את הפרשה הנוכחית
            return "בהעלותך"; // דוגמה לפרשה נוכחית
        }
        
        // פונקציה לטעינת התוכן מגוגל שיטס
        async function loadParashaContent(parashaName = null) {
            try {
                // קבל את הפרשה הנוכחית אם לא נבחרה פרשה ספציפית
                if (!parashaName) {
                    parashaName = getCurrentParasha();
                }
                
                // עדכון שם הפרשה בכותרת
                document.getElementById('current-parasha-name').textContent = parashaName;
                
                // כאן נשתמש בקישור המוגדר בתחילת הקובץ
                const url = SHEET_URL;
                
                const response = await fetch(url);
                const csvText = await response.text();
                
                // נפרסר את ה-CSV
                const rows = parseCSV(csvText);
                
                // נחפש את השורה המתאימה לפרשה הנוכחית
                let contentRow = null;
                
                // הדפסת כל השורות לצורכי דיבוג (אפשר להסיר אחרי שמוודאים שהכל עובד)
                console.log("כל השורות מהגיליון:", rows);
                
                for (let i = 0; i < rows.length; i++) {
                    console.log(`שורה ${i}:`, rows[i]);
                    // בדיקה שהשורה מכילה מספיק עמודות
                    if (rows[i].length < 1) continue;
                    
                    // בדיקה אם העמודה הראשונה (פרשה) תואמת את הפרשה המבוקשת
                    if (rows[i][0] && rows[i][0].trim() === parashaName) {
                        contentRow = rows[i];
                        console.log("נמצאה התאמה לפרשה:", parashaName, contentRow);
                        break;
                    }
                }
                
                // אם לא מצאנו תוכן ספציפי לפרשה, נשתמש בשורה האחרונה
                if (!contentRow && rows.length > 0) {
                    contentRow = rows[rows.length - 1];
                    console.log("לא נמצאה התאמה לפרשה, משתמש בשורה האחרונה:", contentRow);
                }
                
                // הצגת התוכן הראשי
                if (contentRow) {
                    displayContent(contentRow);
                } else {
                    document.getElementById('content-area').innerHTML = `
                        <div class="content-container">
                            <div class="content-header">
                                <h3 class="content-title">אין תוכן זמין</h3>
                            </div>
                            <div class="content-body">
                                <p>אין כרגע דבר תורה זמין לפרשת ${parashaName}.</p>
                            </div>
                        </div>
                    `;
                }
                
                // טעינת ארכיון פרשות קודמות
                loadArchiveItems(rows, parashaName);
                
            } catch (error) {
                document.getElementById('content-area').innerHTML = `
                    <div class="content-container">
                        <div class="content-header">
                            <h3 class="content-title">שגיאה בטעינת התוכן</h3>
                        </div>
                        <div class="content-body">
                            <p>לא ניתן לטעון את התוכן כרגע. אנא נסה שוב מאוחר יותר.</p>
                        </div>
                    </div>
                `;
                console.error('Error loading content:', error);
            }
        }
        
        // פונקציה פשוטה לפרסור CSV
        function parseCSV(text) {
            const rows = [];
            const lines = text.split('\n');
            
            console.log("מספר שורות בקובץ CSV:", lines.length);
            
            // נדלג על שורת הכותרות
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim() === '') continue;
                
                // פירוק שורה תוך התחשבות במרכאות
                let row = [];
                let inQuotes = false;
                let currentValue = '';
                
                for (let j = 0; j < lines[i].length; j++) {
                    const char = lines[i][j];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        row.push(currentValue);
                        currentValue = '';
                    } else {
                        currentValue += char;
                    }
                }
                
                row.push(currentValue); // הוספת הערך האחרון
                rows.push(row);
            }
            
            console.log("שורות לאחר פרסור:", rows);
            return rows;
        }
        
        // הצגת התוכן הראשי בעמוד
        function displayContent(contentRow) {
            // בהנחה שהעמודות בסדר: פרשה, תאריך עדכון, כותרת, תוכן, כותב
            const [parasha, updateDate, title, content, author] = contentRow;
            
            const contentHtml = `
                <div class="content-container">
                    <div class="content-header">
                        <h3 class="content-title">${title}</h3>
                        <div class="content-meta">
                            <span>מאת: ${author}</span> | 
                            <span>עודכן בתאריך: ${updateDate}</span>
                        </div>
                    </div>
                    <div class="content-body">
                        ${content}
                    </div>
                </div>
            `;
            
            document.getElementById('content-area').innerHTML = contentHtml;
        }
        
        // טעינת פריטי ארכיון
        function loadArchiveItems(rows, currentParasha) {
            const archiveContainer = document.getElementById('archive-items');
            archiveContainer.innerHTML = '';
            
            // מיון השורות לפי תאריך (מהחדש לישן)
            rows.sort((a, b) => {
                const dateA = new Date(a[1]);
                const dateB = new Date(b[1]);
                return dateB - dateA;
            });
            
            // מספר מוגבל של פריטים להצגה בארכיון
            const maxItems = 4;
            let count = 0;
            
            for (const row of rows) {
                const [parasha, updateDate, title, content, author] = row;
                
                // דלג על הפרשה הנוכחית
                if (parasha === currentParasha) continue;
                
                // הגבלת מספר הפריטים
                if (count >= maxItems) break;
                
                const archiveItem = document.createElement('div');
                archiveItem.className = 'archive-item';
                archiveItem.innerHTML = `
                    <h4>${title}</h4>
                    <p>פרשת ${parasha}</p>
                    <p>מאת: ${author}</p>
                    <a href="#" onclick="loadParashaContent('${parasha}'); return false;">לקריאה</a>
                `;
                
                archiveContainer.appendChild(archiveItem);
                count++;
            }
            
            if (count === 0) {
                archiveContainer.innerHTML = '<p style="text-align: center; grid-column: 1/-1;">אין דברי תורה קודמים בארכיון.</p>';
            }
        }
        
        // אתחול הדף כשהוא נטען
        window.addEventListener('DOMContentLoaded', () => {
            loadParashotOptions();
            loadParashaContent();
        });
    </script>
</body>
</html>
